{
  "info": {
    "name": "OpsFlow Backend Demo",
    "_postman_id": "3f1d2db3-bc7b-4e46-bca6-2a6c353a9bf6",
    "description": "Demo flow for local OpsFlow backend: auth, branches, cash movements and stats.",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "01 Auth Setup",
      "item": [
        {
          "name": "Health",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/health",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "health"
              ]
            }
          }
        },
        {
          "name": "Register",
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "if (!pm.environment.get('userEmail')) {",
                  "  const random = Date.now();",
                  "  pm.environment.set('userEmail', `demo.${random}@opsflow.local`);",
                  "}"
                ]
              }
            },
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('register status', function () { pm.response.to.have.status(201); });",
                  "const json = pm.response.json();",
                  "if (json.accessToken) { pm.environment.set('accessToken', json.accessToken); }"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"{{userEmail}}\",\n  \"password\": \"{{userPassword}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/register",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "auth",
                "register"
              ]
            }
          }
        },
        {
          "name": "Login",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('login status', function () { pm.response.to.have.status(201); });",
                  "const json = pm.response.json();",
                  "if (json.accessToken) { pm.environment.set('accessToken', json.accessToken); }"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"{{userEmail}}\",\n  \"password\": \"{{userPassword}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/login",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "auth",
                "login"
              ]
            }
          }
        },
        {
          "name": "Get CSRF",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('csrf status', function () { pm.response.to.have.status(200); });",
                  "const setCookie = pm.response.headers.get('set-cookie') || '';",
                  "const match = setCookie.match(/csrf_token=([^;]+)/);",
                  "if (match && match[1]) { pm.environment.set('csrfToken', match[1]); }"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/auth/csrf",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "auth",
                "csrf"
              ]
            }
          }
        },
        {
          "name": "Me",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/auth/me",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "auth",
                "me"
              ]
            }
          }
        }
      ]
    },
    {
      "name": "02 Branches",
      "item": [
        {
          "name": "Create Branch (ADMIN)",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('branch created', function () { pm.response.to.have.status(201); });",
                  "const json = pm.response.json();",
                  "if (json.id) { pm.environment.set('branchId', json.id); }"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Casa Central\",\n  \"code\": \"CC01\",\n  \"cashLimit\": 5000\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/branches",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "branches"
              ]
            }
          }
        },
        {
          "name": "List Branches",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/branches",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "branches"
              ]
            }
          }
        }
      ]
    },
    {
      "name": "03 Cash Movements",
      "item": [
        {
          "name": "Create Income (PENDING)",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('movement created', function () { pm.response.to.have.status(201); });",
                  "const json = pm.response.json();",
                  "if (json.id) { pm.environment.set('movementId', json.id); }"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"type\": \"INCOME\",\n  \"amount\": 2500.50,\n  \"description\": \"Ingreso demo\",\n  \"branchId\": \"{{branchId}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/cash-movements",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "cash-movements"
              ]
            }
          }
        },
        {
          "name": "List Cash Movements",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/cash-movements?branchId={{branchId}}",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "cash-movements"
              ],
              "query": [
                {
                  "key": "branchId",
                  "value": "{{branchId}}"
                }
              ]
            }
          }
        },
        {
          "name": "Approve Movement (MANAGER/ADMIN)",
          "request": {
            "method": "PATCH",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/cash-movements/{{movementId}}/approve",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "cash-movements",
                "{{movementId}}",
                "approve"
              ]
            }
          }
        },
        {
          "name": "Deliver Movement (MANAGER/ADMIN)",
          "request": {
            "method": "PATCH",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/cash-movements/{{movementId}}/deliver",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "cash-movements",
                "{{movementId}}",
                "deliver"
              ]
            }
          }
        }
      ]
    },
    {
      "name": "04 Cashflow Stats",
      "item": [
        {
          "name": "Stats By Branch",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/cashflow/stats?branchId={{branchId}}",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "cashflow",
                "stats"
              ],
              "query": [
                {
                  "key": "branchId",
                  "value": "{{branchId}}"
                }
              ]
            }
          }
        }
      ]
    }
  ]
}
